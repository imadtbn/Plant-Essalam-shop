<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>مشتلة السلام</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;font-family:'Tajawal',sans-serif}
    body{margin:0;background:#f5f5f5;color:#333}
    header{text-align:center;padding:15px;background:#2e7d32;color:#fff;font-size:1.5rem}
    .categories{display:flex;overflow-x:auto;padding:10px;background:#fff;gap:10px}
    .categories button{flex:0 0 auto;padding:8px 12px;border:none;border-radius:20px;background:#e0e0e0;cursor:pointer}
    .categories button.active, .categories button:hover{background:#2e7d32;color:#fff}
    .products{display:grid;gap:15px;padding:15px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}
    .card{background:#fff;padding:12px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1);text-align:center}
    .card h3{margin:10px 0;font-size:1.1rem}
    .card p{margin:5px 0;color:#555;font-size:0.95rem}
    .btn{margin-top:8px;padding:8px 12px;border:none;background:#2e7d32;color:#fff;border-radius:6px;cursor:pointer;font-size:0.95rem}
    .cart-btn{position:fixed;bottom:20px;right:20px;background:#2e7d32;color:#fff;border:none;border-radius:50%;width:60px;height:60px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;cursor:pointer}
    #cart-count{position:absolute;top:5px;right:5px;background:#d32f2f;padding:2px 6px;border-radius:50%;font-size:0.75rem}
    .cart-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center}
    .cart-content{background:#fff;border-radius:10px;padding:20px;width:90%;max-width:400px;max-height:90%;overflow:auto}
    .cart-item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #eee}
    input,textarea{width:100%;padding:8px;margin:8px 0;border:1px solid #ccc;border-radius:6px}
  </style>
</head>
<body>
  <header>مشتلة السلام</header>
  <div class="categories" id="categories"></div>
  <div class="products" id="products"></div>
  <button class="cart-btn" id="open-cart"><i class="fa fa-shopping-cart"></i><span id="cart-count">0</span></button>
  <div class="cart-modal" id="cart-modal">
    <div class="cart-content">
      <h2>سلة المشتريات</h2><div id="cart-items"></div>
      <h3>بياناتك</h3>
      <input id="c_name" placeholder="الاسم الكامل">
      <input id="c_phone" placeholder="رقم الهاتف">
      <textarea id="c_address" placeholder="العنوان"></textarea>
      <button class="btn" onclick="submitOrder()">تأكيد الطلب</button>
      <button class="btn" style="background:#c62828" onclick="closeCart()">إغلاق</button>
    </div>
  </div>

  <script>
    const API = "https://script.google.com/macros/s/AKfycbwf3RgEZ31JDu7JLv9t_4aMEZR2mXJ2kmlFfmDiYDTDQw1lgeuBoVpiAYgcG2Y2XImwsQ/exec";
    let categories = [], products = [], cart=[];
    async function init(){
      categories = await (await fetch(API+"?sheet=categories")).json();
      products = await (await fetch(API+"?sheet=products")).json();
      renderCategories(); renderProducts();
    }
    function renderCategories(){
      const cont = document.getElementById("categories");
      cont.innerHTML = categories.map(c=>`<button onclick="filterCat('${c.name}')">${c.name}</button>`).join('');
      cont.children[0]?.classList.add("active");
    }
    function filterCat(cat){
      document.querySelectorAll(".categories button").forEach(b=>b.classList.toggle("active", b.textContent===cat));
      renderProducts(cat);
    }
    function renderProducts(cat){
      const list = cat ? products.filter(p=>p.category===cat) : products;
      const cont = document.getElementById("products");
      cont.innerHTML = list.map(p=>`
        <div class="card">
          <h3>${p.name}</h3>
          <p>${p.price} دج</p>
          <button class="btn" onclick='addToCart(${JSON.stringify(p)})'>أضف للسلة</button>
        </div>`).join('');
    }
    function addToCart(p){
      cart.push(p);
      document.getElementById("cart-count").textContent = cart.length;
    }
    document.getElementById("open-cart").onclick = () => document.getElementById("cart-modal").style.display = "flex";
    function closeCart(){document.getElementById("cart-modal").style.display = "none";}
    function submitOrder(){
      const order = {
        customerName: document.getElementById("c_name").value,
        phone: document.getElementById("c_phone").value,
        address: document.getElementById("c_address").value,
        items: cart.map(i=>i.name).join(", "),
        total: cart.reduce((s,i)=>s+ +i.price,0)
      };
      fetch(API, {method:"POST", body: JSON.stringify({action:"addOrder", ...order})});
      alert("تم إرسال الطلب");
      cart=[]; document.getElementById("cart-count").textContent = 0;
      closeCart();
    }
    init();
  </script>
</body>
</html>
