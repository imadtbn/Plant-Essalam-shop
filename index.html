<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🌱 مشتلة السلام</title>
  <style>
    body{font-family:Arial, sans-serif;margin:0;padding:0;background:#f4f8f3;color:#333}
    header{background:#2e7d32;color:#fff;padding:15px;position:fixed;top:0;width:100%;z-index:1000}
    header h1{margin:0;font-size:22px}
    .container{max-width:1200px;margin:100px auto 60px;padding:20px}
    .products{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}
    .product{background:#fff;border-radius:12px;box-shadow:0 2px 5px rgba(0,0,0,0.1);padding:15px;text-align:center}
    .product img{max-width:100%;border-radius:12px;height:200px;object-fit:cover}
    .product h3{margin:10px 0;font-size:18px}
    .product p{color:#666;font-size:14px}
    .product button{background:#2e7d32;color:#fff;border:none;padding:10px 15px;border-radius:8px;cursor:pointer}
    .product button:hover{background:#256028}
    /* السلة */
    #cartBar{position:fixed;top:70px;right:0;width:320px;background:#fff;height:100%;box-shadow:-2px 0 6px rgba(0,0,0,0.2);padding:15px;transform:translateX(100%);transition:.3s;z-index:2000;overflow-y:auto}
    #cartBar.active{transform:translateX(0)}
    #cart-items li{display:flex;justify-content:space-between;align-items:center;margin:8px 0;font-size:14px}
    #cart-items button{background:red;color:#fff;border:none;border-radius:5px;cursor:pointer;padding:3px 6px}
    #openCartBtn{position:fixed;bottom:20px;right:20px;background:#2e7d32;color:#fff;padding:12px 20px;border-radius:50px;border:none;cursor:pointer;z-index:2100}
    /* مودال الطلب */
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);justify-content:center;align-items:center;z-index:3000}
    .modal-content{background:#fff;padding:20px;border-radius:12px;width:90%;max-width:400px}
    .modal input,.modal textarea{width:100%;padding:8px;margin:6px 0;border:1px solid #ccc;border-radius:6px}
    .modal button{margin-top:8px;width:100%;padding:10px;border:none;border-radius:6px;cursor:pointer}
    .close{cursor:pointer;color:#333;float:left}
    footer{background:#2e7d32;color:#fff;text-align:center;padding:15px;position:fixed;bottom:0;width:100%}
    #back-to-top{position:fixed;bottom:80px;right:20px;background:#256028;color:#fff;padding:10px 15px;border-radius:50%;display:none;cursor:pointer;z-index:2200}
    #toast{visibility:hidden;min-width:200px;margin-left:-100px;background:#333;color:#fff;text-align:center;border-radius:6px;padding:12px;position:fixed;z-index:5000;left:50%;bottom:40px;font-size:14px}
    #toast.show{visibility:visible;animation:fadein .5s, fadeout .5s 2.5s}
    @keyframes fadein{from{bottom:0;opacity:0}to{bottom:40px;opacity:1}}
    @keyframes fadeout{from{bottom:40px;opacity:1}to{bottom:0;opacity:0}}
  </style>
</head>
<body>
<header>
  <h1>🌱 مشتلة السلام</h1>
  <input type="text" id="search" placeholder="🔍 ابحث عن منتج..." style="padding:8px;border-radius:8px;border:none;margin-top:10px;width:90%;max-width:400px">
</header>

<div class="container">
  <div class="products" id="productList"></div>
</div>

<button id="openCartBtn">🛒 السلة (<span id="cartCount">0</span>)</button>

<div id="cartBar">
  <h2>سلة المشتريات</h2>
  <ul id="cart-items"></ul>
  <p>المجموع: <span id="totalPrice">0</span> دج</p>
  <button onclick="openModal()">إتمام الطلب</button>
</div>

<div id="orderModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3>📝 بيانات الزبون</h3>
    <input type="text" id="customerName" placeholder="الاسم الكامل" required>
    <input type="tel" id="customerPhone" placeholder="رقم الهاتف" required>
    <textarea id="customerAddress" placeholder="العنوان"></textarea>
    <button style="background:#2e7d32;color:#fff" onclick="checkout('whatsapp')">إرسال عبر واتساب</button>
    <button style="background:#555;color:#fff" onclick="checkout('direct')">إرسال مباشر</button>
  </div>
</div>

<div id="toast"></div>
<div id="back-to-top" onclick="window.scrollTo({top:0,behavior:'smooth'})">⬆</div>

<footer>جميع الحقوق محفوظة © 2025 🌱 مشتلة السلام</footer>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbyYOUR_SCRIPT_ID/exec";
let products=[
  {id:1,name:"وردة حمراء",price:500,img:"https://i.imgur.com/5Z6sUqP.jpg",desc:"نبتة مزهرة جميلة"},
  {id:2,name:"صبار صغير",price:300,img:"https://i.imgur.com/DxQX6qW.jpg",desc:"صبار للديكور"},
  {id:3,name:"شجرة زيتون",price:1500,img:"https://i.imgur.com/OVcE8Rh.jpg",desc:"شجرة مباركة"},
  {id:4,name:"شجرة ليمون",price:1200,img:"https://i.imgur.com/kDHzq5L.jpg",desc:"فاكهة طازجة"},
  {id:5,name:"نعناع",price:200,img:"https://i.imgur.com/fumV2oH.jpg",desc:"نبات عطري"}
];
let cart=[];

function loadProducts(){
  const list=document.getElementById("productList");
  list.innerHTML="";
  products.forEach(p=>{
    let div=document.createElement("div");
    div.className="product";
    div.innerHTML=`<img src="${p.img}" alt="${p.name}">
                   <h3>${p.name}</h3>
                   <p>${p.desc}</p>
                   <p><b>${p.price} دج</b></p>
                   <button onclick="addToCart(${p.id})">➕ أضف للسلة</button>`;
    list.appendChild(div);
  });
}

function addToCart(id){
  let p=products.find(x=>x.id===id);
  let item=cart.find(i=>i.id===id);
  if(item){item.qty++;}else{cart.push({...p,qty:1});}
  renderCart();showToast("✅ تمت الإضافة للسلة");
}

function renderCart(){
  let list=document.getElementById("cart-items");
  list.innerHTML="";
  let total=0,count=0;
  cart.forEach((i,index)=>{
    total+=i.price*i.qty;count+=i.qty;
    list.innerHTML+=`<li>${i.name} x${i.qty} - ${i.price*i.qty} دج 
                     <button onclick="removeFromCart(${index})">🗑</button></li>`;
  });
  document.getElementById("totalPrice").innerText=total;
  document.getElementById("cartCount").innerText=count;
}

function removeFromCart(i){cart.splice(i,1);renderCart();}
function openModal(){document.getElementById("orderModal").style.display="flex";}
function closeModal(){document.getElementById("orderModal").style.display="none";}
function openCart(){document.getElementById("cartBar").classList.add("active");}
function closeCart(){document.getElementById("cartBar").classList.remove("active");}
document.getElementById("openCartBtn").onclick=()=>document.getElementById("cartBar").classList.toggle("active");

function checkout(method){
  const name=document.getElementById("customerName").value.trim();
  const phone=document.getElementById("customerPhone").value.trim();
  const address=document.getElementById("customerAddress").value.trim();

  if(!name || !phone || cart.length===0){
    alert("⚠️ أدخل بياناتك كاملة وأضف منتجات للسلة");
    return;
  }

  const itemsStr=cart.map(i=>`${i.name} x${i.qty}`).join(", ");
  const total=cart.reduce((s,i)=>s+i.price*i.qty,0);

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"addOrder",
      customerName:name,
      phone,
      customerAddress:address,
      items:itemsStr,
      total:total,
      status:"جديد"
    })
  });

  if(method==="whatsapp"){
    const msg=`طلب جديد:%0A👤 ${name}%0A📞 ${phone}%0A📍 ${address}%0A🛒 ${itemsStr}%0A💰 ${total} دج`;
    window.open(`https://wa.me/213697743721?text=${msg}`,"_blank");
  } else {
    showToast("✅ تم إرسال الطلب بنجاح إلى المشتلة!");
  }

  cart=[];
  renderCart();
  closeCart();
  closeModal();
}

function showToast(msg){
  const toast=document.getElementById("toast");
  toast.innerText=msg;
  toast.className="show";
  setTimeout(()=>toast.className=toast.className.replace("show",""),3000);
}

window.onscroll=()=>{
  document.getElementById("back-to-top").style.display=
    window.scrollY>200 ? "block":"none";
}

loadProducts();
</script>
</body>
</html>